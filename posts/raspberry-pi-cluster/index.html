<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Self-hosting on a Raspberry Pi cluster | codeFright</title>
<meta name=keywords content><meta name=description content="Moving all my personal websites to a Raspberry Pi cluster sitting in my home office"><meta name=author content="Anu S Pillai"><link rel=canonical href=https://www.codefright.com/posts/raspberry-pi-cluster/><link crossorigin=anonymous href=/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as=style><link rel=icon href=https://www.codefright.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.codefright.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.codefright.com/favicon-32x32.png><link rel=apple-touch-icon href=https://www.codefright.com/apple-touch-icon.png><link rel=mask-icon href=https://www.codefright.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://www.codefright.com/posts/raspberry-pi-cluster/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Self-hosting on a Raspberry Pi cluster"><meta property="og:description" content="Moving all my personal websites to a Raspberry Pi cluster sitting in my home office"><meta property="og:type" content="article"><meta property="og:url" content="https://www.codefright.com/posts/raspberry-pi-cluster/"><meta property="og:image" content="https://www.codefright.com/static/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-04-06T12:13:43-07:00"><meta property="article:modified_time" content="2024-04-06T12:13:43-07:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.codefright.com/static/logo.png"><meta name=twitter:title content="Self-hosting on a Raspberry Pi cluster"><meta name=twitter:description content="Moving all my personal websites to a Raspberry Pi cluster sitting in my home office"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.codefright.com/posts/"},{"@type":"ListItem","position":2,"name":"Self-hosting on a Raspberry Pi cluster","item":"https://www.codefright.com/posts/raspberry-pi-cluster/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Self-hosting on a Raspberry Pi cluster","name":"Self-hosting on a Raspberry Pi cluster","description":"Moving all my personal websites to a Raspberry Pi cluster sitting in my home office","keywords":[],"articleBody":"This post is an overview of how I went off the grid ‚Äì or, in other words, moved all my personal websites off Azure and onto a Raspberry Pi cluster sitting in my home office. This isn‚Äôt exactly a tutorial blog post, but feel free to use this as a reference.\nWhy do this at all? You might be wondering, ‚ÄúSavannah, why do this? Didn‚Äôt you used to work on Azure tooling full-time?‚Äù To which I‚Äôd reply, ‚ÄúYes, yes I did.‚Äù But really, this isn‚Äôt about criticizing Azure or any other major cloud service provider. I simply enjoy physical computing, like to experiment, and also no longer receive any free employee credits for Azure, so I thought, why not?\nMeet Arrakis! Alright, I might have had Dune on the brain when I built this, but Dune Part Two is literally a masterpiece, so can you blame me? My little rig consists of 3 Raspberry Pi 4Bs (each with 4 CPUs and 8 GB RAM), all running Raspberry Pi OS Lite (64-bit), which is a port of Debian Bullseye without a desktop environment. Each of these devices uses Power over Ethernet (PoE) for networking and power over a single cable per Pi. I‚Äôll delve into this a bit later, but it‚Äôs worth noting that the cluster doesn‚Äôt run Kubernetes; instead, it leverages Docker Swarm to create the cluster (it‚Äôs literally 2 commands to configure everything ‚Äì mind blown!).\nMaterials for the build I‚Äôll be candid ‚Äì this wasn‚Äôt cheap. Raspberry Pis are hot commodities, so it cost me a pretty penny to gather everything I needed for this build. I‚Äôll link what I bought, but do keep in mind that prices may vary. At the time of building, this set me back approximately $506.67 USD.\nItem Price (in USD) Notes C4Labs Cloudlet Case in Clear $99.08 Though I‚Äôm only building a 3 Pi cluster right now, this gives me some space to store the Switch or add additional Pis in the future TP-Link TL-SG1005P, 5 Port Gigabit PoE Switch $49.53 UCTRONICS PoE HAT for Raspberry Pi (3x) $21.99 1.5-ft Ethernet cables (6 pack) $16.99 Raspberry Pi 4 Model B 8GB (3x) $82.71 Obviously, this is where I spent the most money. SanDisk Ultra 32GB Micro SD (3x) $8.99 Total $506.67 That said, if you‚Äôre following along, you may need a couple of other things depending on what you have lying around at home, like a memory card reader for imaging the SD cards. Thankfully, I had one built into my USB dock, so this was unnecessary.\nSetting up the cluster Step 1: Image a micro SD card for each Pi After assembling the cluster physically, it was time to sort out the software bits. First, I imaged each micro SD card with Raspberry Pi OS Lite using the Raspberry Pi Imager utility, and then I inserted each micro SD into each Pi. A vital step here is to remember to go into options and tick the box that allows you to configure SSH with a password before imaging the SD cards.\nStep 2: Install Docker üê≥ Then, I waited for each of them to appear on my home network and grabbed their IP addresses and made note of which Pi had which IP address. After that, I ssh‚Äôd into each one and installed Docker using the official release (which gets updated more frequently than Docker distributed via distros‚Ä¶heck yes, Moby 26 is out!). I had 3 different terminal tabs opened while I was working so I could switch between them quickly.\nStep 3: Create the cluster using Docker Swarm I‚Äôll be honest ‚Äì I initially planned to set up the cluster with Kubernetes via k3s, but boy howdy, that gave me so many problems right from the get-go. Also, it‚Äôs a bit of a meme to host your blog on Kubernetes, so I quickly changed my plan and decided to use Swarm instead. Setting this up was truly magical, save for one snag. Here‚Äôs how it works:\nChoose one of your Pis to be your Swarm leader. Run docker swarm init in the Swarm leader‚Äôs terminal. Copy the generated command and token (docker swarm join). Paste the docker swarm join command into the other Pi terminals. Boom! You have yourself a cluster ‚ú® Seriously, it‚Äôs that simple! You can validate that everything is working as expected using docker node ls on any of your nodes. Note: I did run into one little snag with networking, where the default network of the cluster overlapped 1:1 with my home network. I discovered this much later when ingress was broken and I couldn‚Äôt figure out why. Before moving on, it might be worth verifying that this is not the case. If it is, the fix is fairly simple. You‚Äôll just need to customize the ingress network. Shout out to this StackOverflow post for helping me debug this!\nStep 4: Write the docker-compose.yml for your services Time to get to defining our services! In this case, I had two websites I wanted to host: 1) my personal website (where you‚Äôre reading this post!) and 2) an uber-professional website that‚Äôs an inside joke.\nIf you‚Äôre familiar with Docker, this part is quite straightforward. I had already pushed my website images up to Docker Hub, so this was a pretty quick operation. The only Swarm-specific thing I needed to do is to tell Docker that I had a custom network called arrakis and then make sure that my services connect to it.\nservices: savannahdev: image: \"savannahostrowski/savannah.dev\" ports: - \"8080:80\" networks: - arrakis deploy: mode: replicated replicas: 3 getshreked: image: \"savannahostrowski/getshreked\" ports: - \"8081:80\" networks: - arrakis deploy: mode: replicated replicas: 3 networks: arrakis: {} Deploying this Compose file is a single command using docker stack deploy --compose-file docker-compose.yml arrakis from the leader node. Once this command was run, I validated that the services were operational via docker stack services arrakis.\nAt this point, you should be able to hit the endpoints on any one of the cluster node IPs and see your website!\nStep 5: Set up cloudflared as a service in the cluster The last bit here was to obfuscate my IP addresses and make this all accessible to the outside world via my chosen domains. If you thought the cluster setup was magic, just wait until you see how simple it was to set this bit up.\nThanks to CloudFlare, I‚Äôm able to do this all via Tunnels ‚Äì or, rather, a single Cloudflared tunnel in my case. This was really as easy as going to my CloudFlare dashboard, creating a tunnel, copying an installation command to paste into my leader node (sudo cloudflared service install ), creating another service in my docker-compose.yml, and then redeploying the stack (docker stack deploy --compose-file docker-compose.yml arrakis).\nservices: savannahdev: image: \"savannahostrowski/savannah.dev\" ports: - \"8080:80\" networks: - arrakis deploy: mode: replicated replicas: 3 getshreked: image: \"savannahostrowski/getshreked\" ports: - \"8081:80\" networks: - arrakis deploy: mode: replicated replicas: 3 cloudflared: image: \"cloudflare/cloudflared\" command: \"tunnel --no-autoupdate run --token \" deploy: restart_policy: condition: on-failure mode: replicated replicas: 3 networks: - arrakis networks: arrakis: {} The last bit here is to configure your public hostnames. In my case, I had one for each website I was deploying. What‚Äôs really neat is that you just have to pass in the service name:port (where service name matches the Compose service name and port matches your port internal to the container) for it to all work. Bonus: Set up Tailscale for easy access to my cluster nodes This isn‚Äôt required but I also took advantage of Tailscale‚Äôs free tier (up to 100 devices!) for easy access to my cluster nodes.\nAnd that‚Äôs pretty much it! Hopefully you found this sort of fun - I sure did!\n","wordCount":"1289","inLanguage":"en","image":"https://www.codefright.com/static/logo.png","datePublished":"2024-04-06T12:13:43-07:00","dateModified":"2024-04-06T12:13:43-07:00","author":{"@type":"Person","name":"Anu S Pillai"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.codefright.com/posts/raspberry-pi-cluster/"},"publisher":{"@type":"Person","name":"codeFright","logo":{"@type":"ImageObject","url":"https://www.codefright.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.codefright.com/ accesskey=h title="codeFright (Alt + H)">codeFright</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.codefright.com/ title=Home><span>Home</span></a></li><li><a href=https://www.codefright.com/archives title=Archive><span>Archive</span></a></li><li><a href=https://www.codefright.com/projects title=Projects><span>Projects</span></a></li><li><a href=https://www.codefright.com/tags title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://www.codefright.com/>Home</a>&nbsp;¬ª&nbsp;<a href=https://www.codefright.com/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Self-hosting on a Raspberry Pi cluster</h1><div class=post-description>Moving all my personal websites to a Raspberry Pi cluster sitting in my home office</div><div class=post-meta><span title='2024-04-06 12:13:43 -0700 -0700'>April 6, 2024</span>&nbsp;¬∑&nbsp;7 min&nbsp;¬∑&nbsp;1289 words&nbsp;¬∑&nbsp;Anu S Pillai</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#why-do-this-at-all aria-label="Why do this at all?">Why do this at all?</a></li><li><a href=#meet-arrakis aria-label="Meet Arrakis!">Meet Arrakis!</a><ul><li><a href=#materials-for-the-build aria-label="Materials for the build">Materials for the build</a></li></ul></li><li><a href=#setting-up-the-cluster aria-label="Setting up the cluster">Setting up the cluster</a><ul><li><a href=#step-1-image-a-micro-sd-card-for-each-pi aria-label="Step 1: Image a micro SD card for each Pi">Step 1: Image a micro SD card for each Pi</a></li><li><a href=#step-2-install-docker- aria-label="Step 2: Install Docker üê≥">Step 2: Install Docker üê≥</a></li><li><a href=#step-3-create-the-cluster-using-docker-swarm aria-label="Step 3: Create the cluster using Docker Swarm">Step 3: Create the cluster using Docker Swarm</a></li><li><a href=#step-4-write-the-docker-composeyml-for-your-services aria-label="Step 4: Write the docker-compose.yml for your services">Step 4: Write the docker-compose.yml for your services</a></li><li><a href=#step-5-set-up-cloudflared-as-a-service-in-the-cluster aria-label="Step 5: Set up cloudflared as a service in the cluster">Step 5: Set up cloudflared as a service in the cluster</a></li></ul></li><li><a href=#bonus-set-up-tailscale-for-easy-access-to-my-cluster-nodes aria-label="Bonus: Set up Tailscale for easy access to my cluster nodes">Bonus: Set up Tailscale for easy access to my cluster nodes</a></li></ul></div></details></div><div class=post-content><p>This post is an overview of how I went off the grid ‚Äì or, in other words, moved all my personal websites off Azure and onto a Raspberry Pi cluster sitting in my home office. This isn&rsquo;t exactly a tutorial blog post, but feel free to use this as a reference.</p><h2 id=why-do-this-at-all>Why do this at all?<a hidden class=anchor aria-hidden=true href=#why-do-this-at-all>#</a></h2><p>You might be wondering, &ldquo;Savannah, why do this? Didn&rsquo;t you used to work on Azure tooling full-time?&rdquo; To which I&rsquo;d reply, &ldquo;Yes, yes I did.&rdquo; But really, this isn&rsquo;t about criticizing Azure or any other major cloud service provider. I simply enjoy physical computing, like to experiment, and also no longer receive any free employee credits for Azure, so I thought, why not?</p><h2 id=meet-arrakis>Meet Arrakis!<a hidden class=anchor aria-hidden=true href=#meet-arrakis>#</a></h2><p>Alright, I might have had Dune on the brain when I built this, but Dune Part Two is literally a masterpiece, so can you blame me? My little rig consists of 3 Raspberry Pi 4Bs (each with 4 CPUs and 8 GB RAM), all running Raspberry Pi OS Lite (64-bit), which is a port of Debian Bullseye without a desktop environment. Each of these devices uses Power over Ethernet (PoE) for networking and power over a single cable per Pi. I&rsquo;ll delve into this a bit later, but it&rsquo;s worth noting that the cluster doesn&rsquo;t run Kubernetes; instead, it leverages Docker Swarm to create the cluster (it&rsquo;s literally 2 commands to configure everything ‚Äì mind blown!).</p><p><img loading=lazy src=../cluster-1.png alt="alt text"></p><h3 id=materials-for-the-build>Materials for the build<a hidden class=anchor aria-hidden=true href=#materials-for-the-build>#</a></h3><p>I&rsquo;ll be candid ‚Äì this wasn&rsquo;t cheap. Raspberry Pis are hot commodities, so it cost me a pretty penny to gather everything I needed for this build. I&rsquo;ll link what I bought, but do keep in mind that prices may vary. At the time of building, this set me back approximately $506.67 USD.</p><table><thead><tr><th>Item</th><th>Price (in USD)</th><th>Notes</th></tr></thead><tbody><tr><td><a href=https://www.amazon.com/gp/product/B07D5NM9ZG>C4Labs Cloudlet Case in Clear</a></td><td>$99.08</td><td>Though I&rsquo;m only building a 3 Pi cluster right now, this gives me some space to store the Switch or add additional Pis in the future</td></tr><tr><td><a href=https://www.amazon.com/gp/product/B076HZFY3F>TP-Link TL-SG1005P, 5 Port Gigabit PoE Switch</a></td><td>$49.53</td><td></td></tr><tr><td><a href=https://www.amazon.com/gp/product/B082ZLDMZ6>UCTRONICS PoE HAT for Raspberry Pi (3x)</a></td><td>$21.99</td><td></td></tr><tr><td><a href=https://www.amazon.com/gp/product/B00GBBSX92>1.5-ft Ethernet cables (6 pack)</a></td><td>$16.99</td><td></td></tr><tr><td><a href=https://www.amazon.com/gp/product/B0899VXM8F>Raspberry Pi 4 Model B 8GB (3x)</a></td><td>$82.71</td><td>Obviously, this is where I spent the most money.</td></tr><tr><td><a href=https://www.amazon.com/gp/product/B00M55C0NS>SanDisk Ultra 32GB Micro SD (3x)</a></td><td>$8.99</td><td></td></tr><tr><td><strong>Total</strong></td><td>$506.67</td><td></td></tr></tbody></table><p>That said, if you&rsquo;re following along, you may need a couple of other things depending on what you have lying around at home, like a memory card reader for imaging the SD cards. Thankfully, I had one built into my USB dock, so this was unnecessary.</p><h2 id=setting-up-the-cluster>Setting up the cluster<a hidden class=anchor aria-hidden=true href=#setting-up-the-cluster>#</a></h2><h3 id=step-1-image-a-micro-sd-card-for-each-pi>Step 1: Image a micro SD card for each Pi<a hidden class=anchor aria-hidden=true href=#step-1-image-a-micro-sd-card-for-each-pi>#</a></h3><p>After assembling the cluster physically, it was time to sort out the software bits. First, I imaged each micro SD card with Raspberry Pi OS Lite using the <a href=https://www.raspberrypi.com/software/>Raspberry Pi Imager utility</a>, and then I inserted each micro SD into each Pi. A vital step here is to remember to go into options and tick the box that allows you to configure SSH with a password before imaging the SD cards.</p><h3 id=step-2-install-docker->Step 2: Install Docker üê≥<a hidden class=anchor aria-hidden=true href=#step-2-install-docker->#</a></h3><p>Then, I waited for each of them to appear on my home network and grabbed their IP addresses and made note of which Pi had which IP address. After that, I ssh&rsquo;d into each one and <a href=https://docs.docker.com/engine/install/debian/>installed Docker</a> using the official release (which gets updated more frequently than Docker distributed via distros&mldr;heck yes, Moby 26 is out!). I had 3 different terminal tabs opened while I was working so I could switch between them quickly.</p><h3 id=step-3-create-the-cluster-using-docker-swarm>Step 3: Create the cluster using Docker Swarm<a hidden class=anchor aria-hidden=true href=#step-3-create-the-cluster-using-docker-swarm>#</a></h3><p>I&rsquo;ll be honest ‚Äì I initially planned to set up the cluster with Kubernetes via k3s, but boy howdy, that gave me so many problems right from the get-go. Also, it&rsquo;s a bit of a meme to <a href=https://twitter.com/dexhorthy/status/856639005462417409>host your blog on Kubernetes</a>, so I quickly changed my plan and decided to use Swarm instead. Setting this up was truly magical, save for one snag. Here&rsquo;s how it works:</p><ul><li>Choose one of your Pis to be your Swarm leader.</li><li>Run <code>docker swarm init</code> in the Swarm leader&rsquo;s terminal.</li><li>Copy the generated command and token (<code>docker swarm join</code>).</li><li>Paste the <code>docker swarm join</code> command into the other Pi terminals.</li><li>Boom! You have yourself a cluster ‚ú®</li></ul><p>Seriously, it&rsquo;s that simple! You can validate that everything is working as expected using <code>docker node ls</code> on any of your nodes.
<img loading=lazy src=../docker-node-ls.png alt="Output of docker node ls, with three nodes all in ready state"></p><blockquote><p>Note: I did run into one little snag with networking, where the default network of the cluster overlapped 1:1 with my home network. I discovered this much later when ingress was broken and I couldn&rsquo;t figure out why. Before moving on, it might be worth verifying that this is not the case. If it is, the fix is fairly simple. You&rsquo;ll just need to <a href=https://docs.docker.com/engine/swarm/networking/#customize-ingress>customize the ingress network</a>. Shout out to <a href=https://stackoverflow.com/questions/59007780/container-running-on-docker-swarm-not-accessible-from-outside/63405536#63405536>this StackOverflow post</a> for helping me debug this!</p></blockquote><h3 id=step-4-write-the-docker-composeyml-for-your-services>Step 4: Write the <code>docker-compose.yml</code> for your services<a hidden class=anchor aria-hidden=true href=#step-4-write-the-docker-composeyml-for-your-services>#</a></h3><p>Time to get to defining our services! In this case, I had two websites I wanted to host: 1) my <a href=https://savannahostrowski.com>personal website</a> (where you&rsquo;re reading this post!) and 2) an <a href=https://getshreked.com>uber-professional website</a> that&rsquo;s an inside joke.</p><p>If you&rsquo;re familiar with Docker, this part is quite straightforward. I had already pushed my website images up to Docker Hub, so this was a pretty quick operation. The only Swarm-specific thing I needed to do is to tell Docker that I had a custom network called <code>arrakis</code> and then make sure that my services connect to it.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>services:
</span></span><span class=line><span class=cl>  savannahdev:
</span></span><span class=line><span class=cl>    image: &#34;savannahostrowski/savannah.dev&#34;
</span></span><span class=line><span class=cl>    ports:
</span></span><span class=line><span class=cl>     - &#34;8080:80&#34;
</span></span><span class=line><span class=cl>    networks:
</span></span><span class=line><span class=cl>     - arrakis
</span></span><span class=line><span class=cl>    deploy:
</span></span><span class=line><span class=cl>     mode: replicated
</span></span><span class=line><span class=cl>     replicas: 3
</span></span><span class=line><span class=cl>  getshreked:
</span></span><span class=line><span class=cl>   image: &#34;savannahostrowski/getshreked&#34;
</span></span><span class=line><span class=cl>   ports:
</span></span><span class=line><span class=cl>     - &#34;8081:80&#34;
</span></span><span class=line><span class=cl>   networks:
</span></span><span class=line><span class=cl>     - arrakis
</span></span><span class=line><span class=cl>   deploy:
</span></span><span class=line><span class=cl>     mode: replicated
</span></span><span class=line><span class=cl>     replicas: 3
</span></span><span class=line><span class=cl>networks:
</span></span><span class=line><span class=cl>  arrakis: {}
</span></span></code></pre></div><p>Deploying this Compose file is a single command using <code>docker stack deploy --compose-file docker-compose.yml arrakis</code> from the leader node. Once this command was run, I validated that the services were operational via <code>docker stack services arrakis</code>.</p><p>At this point, you should be able to hit the endpoints on any one of the cluster node IPs and see your website!</p><h3 id=step-5-set-up-cloudflared-as-a-service-in-the-cluster>Step 5: Set up <code>cloudflared</code> as a service in the cluster<a hidden class=anchor aria-hidden=true href=#step-5-set-up-cloudflared-as-a-service-in-the-cluster>#</a></h3><p>The last bit here was to obfuscate my IP addresses and make this all accessible to the outside world via my chosen domains. If you thought the cluster setup was magic, just wait until you see how simple it was to set this bit up.</p><p>Thanks to CloudFlare, I&rsquo;m able to do this all via <a href=https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/>Tunnels</a> ‚Äì or, rather, a single Cloudflared tunnel in my case. This was really as easy as going to my CloudFlare dashboard, creating a tunnel, copying an installation command to paste into my leader node (<code>sudo cloudflared service install &lt;token></code>), creating another service in my <code>docker-compose.yml</code>, and then redeploying the stack (<code>docker stack deploy --compose-file docker-compose.yml arrakis</code>).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>services:
</span></span><span class=line><span class=cl>  savannahdev:
</span></span><span class=line><span class=cl>    image: &#34;savannahostrowski/savannah.dev&#34;
</span></span><span class=line><span class=cl>    ports:
</span></span><span class=line><span class=cl>     - &#34;8080:80&#34;
</span></span><span class=line><span class=cl>    networks:
</span></span><span class=line><span class=cl>     - arrakis
</span></span><span class=line><span class=cl>    deploy:
</span></span><span class=line><span class=cl>     mode: replicated
</span></span><span class=line><span class=cl>     replicas: 3
</span></span><span class=line><span class=cl>  getshreked:
</span></span><span class=line><span class=cl>   image: &#34;savannahostrowski/getshreked&#34;
</span></span><span class=line><span class=cl>   ports:
</span></span><span class=line><span class=cl>     - &#34;8081:80&#34;
</span></span><span class=line><span class=cl>   networks:
</span></span><span class=line><span class=cl>     - arrakis
</span></span><span class=line><span class=cl>   deploy:
</span></span><span class=line><span class=cl>     mode: replicated
</span></span><span class=line><span class=cl>     replicas: 3
</span></span><span class=line><span class=cl>  cloudflared:
</span></span><span class=line><span class=cl>   image: &#34;cloudflare/cloudflared&#34;
</span></span><span class=line><span class=cl>   command: &#34;tunnel --no-autoupdate run --token &lt;my-token-here&gt;&#34;
</span></span><span class=line><span class=cl>   deploy:
</span></span><span class=line><span class=cl>    restart_policy:
</span></span><span class=line><span class=cl>     condition: on-failure
</span></span><span class=line><span class=cl>    mode: replicated
</span></span><span class=line><span class=cl>    replicas: 3
</span></span><span class=line><span class=cl>   networks:
</span></span><span class=line><span class=cl>    - arrakis
</span></span><span class=line><span class=cl>networks:
</span></span><span class=line><span class=cl>  arrakis: {}
</span></span></code></pre></div><p>The last bit here is to configure your public hostnames. In my case, I had one for each website I was deploying. What&rsquo;s really neat is that you just have to pass in the service <code>name:port</code> (where service name matches the Compose service name and port matches your port internal to the container) for it to all work.
<img loading=lazy src=../cloudflare-hostname.png alt="Configuring a hostname for my personal website on Cloudflare"></p><h2 id=bonus-set-up-tailscale-for-easy-access-to-my-cluster-nodes>Bonus: Set up Tailscale for easy access to my cluster nodes<a hidden class=anchor aria-hidden=true href=#bonus-set-up-tailscale-for-easy-access-to-my-cluster-nodes>#</a></h2><p>This isn&rsquo;t required but I also took advantage of <a href=https://tailscale.com/>Tailscale</a>&rsquo;s free tier (up to 100 devices!) for easy access to my cluster nodes.</p><p>And that&rsquo;s pretty much it! Hopefully you found this sort of fun - I sure did!</p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://www.codefright.com/posts/reverse-engg/><span class=title>¬´ Prev</span><br><span>Reverse Engineering an Android APK: A Step-by-Step Guide for Dimwits</span>
</a><a class=next href=https://www.codefright.com/posts/markdown-syntax/><span class=title>Next ¬ª</span><br><span>Markdown Syntax Guide</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Self-hosting on a Raspberry Pi cluster on x" href="https://x.com/intent/tweet/?text=Self-hosting%20on%20a%20Raspberry%20Pi%20cluster&amp;url=https%3a%2f%2fwww.codefright.com%2fposts%2fraspberry-pi-cluster%2f&amp;hashtags="><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Self-hosting on a Raspberry Pi cluster on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fwww.codefright.com%2fposts%2fraspberry-pi-cluster%2f&amp;title=Self-hosting%20on%20a%20Raspberry%20Pi%20cluster&amp;summary=Self-hosting%20on%20a%20Raspberry%20Pi%20cluster&amp;source=https%3a%2f%2fwww.codefright.com%2fposts%2fraspberry-pi-cluster%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Self-hosting on a Raspberry Pi cluster on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwww.codefright.com%2fposts%2fraspberry-pi-cluster%2f&title=Self-hosting%20on%20a%20Raspberry%20Pi%20cluster"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Self-hosting on a Raspberry Pi cluster on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.codefright.com%2fposts%2fraspberry-pi-cluster%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Self-hosting on a Raspberry Pi cluster on whatsapp" href="https://api.whatsapp.com/send?text=Self-hosting%20on%20a%20Raspberry%20Pi%20cluster%20-%20https%3a%2f%2fwww.codefright.com%2fposts%2fraspberry-pi-cluster%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Self-hosting on a Raspberry Pi cluster on telegram" href="https://telegram.me/share/url?text=Self-hosting%20on%20a%20Raspberry%20Pi%20cluster&amp;url=https%3a%2f%2fwww.codefright.com%2fposts%2fraspberry-pi-cluster%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Self-hosting on a Raspberry Pi cluster on ycombinator" href="https://news.ycombinator.com/submitlink?t=Self-hosting%20on%20a%20Raspberry%20Pi%20cluster&u=https%3a%2f%2fwww.codefright.com%2fposts%2fraspberry-pi-cluster%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-XXXX" crossorigin=anonymous></script><ins class=adsbygoogle style=display:inline-block;width:200px;height:800px data-ad-client=ca-pub-XXXX data-ad-slot=XXXX></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><footer class=footer><span>¬© 2024 codeFright</span> ¬∑
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>